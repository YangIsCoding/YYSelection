# 🚀 YYSelection 快速開始指南

## 新開發者一步一步啟動專案

### 步驟 1：clone 專案
```bash
git clone git@github.com:YangIsCoding/YYSelection.git
cd yyselection
```

### 步驟 2：建立環境變數檔案
```bash
cp .env.example .env
```

### 步驟 3：設定環境變數

開啟 `.env` 檔案，依照以下步驟設定每個變數：

#### 🔴 必須設定的變數

##### 3.1 DATABASE_URL
**已設定好，無需修改**
```env
DATABASE_URL="postgresql://postgres:devpassword@db:5432/yyselection"
```

##### 3.2 NEXTAUTH_URL
**已設定好，無需修改**
```env
NEXTAUTH_URL="http://localhost:3002"
```

##### 3.3 NEXTAUTH_SECRET（必須設定）
**生成隨機密鑰**：
```bash
# 方法1：使用 openssl（推薦）
openssl rand -base64 32

# 方法2：線上生成
# 訪問：https://generate-secret.vercel.app/32
```

複製生成的密鑰，貼到 `.env`：
```env
NEXTAUTH_SECRET="生成的32字符密鑰"
```

##### 3.4 Google OAuth 設定（必須設定）

**步驟A：建立 Google Cloud 專案**
1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 點擊右上角「選取專案」→「新增專案」
3. 專案名稱：`yyselection-dev-你的名字`
4. 點擊「建立」

**步驟B：建立 OAuth 2.0 憑證**
1. 在左側選單點擊「API和服務」→「憑證」
2. 點擊「建立憑證」→「OAuth 2.0 用戶端 ID」
3. 如果第一次使用，會要求先設定同意畫面：
   - 選擇「外部」→「建立」
   - 應用程式名稱：`YYSelection Dev`
   - 使用者支援電子郵件：選擇你的 email
   - 開發人員聯絡資訊：填入你的 email
   - 其他欄位可留空，一路點擊「儲存並繼續」
4. 回到憑證建立頁面：
   - 應用程式類型：選擇「網路應用程式」
   - 名稱：`yyselection-localhost`
   - 已授權的重新導向 URI：
     - 點擊「新增 URI」
     - 輸入：`http://localhost:3002/api/auth/callback/google`
5. 點擊「建立」

**步驟C：複製憑證**
建立完成後會顯示彈窗，複製：
- **用戶端 ID**：貼到 `GOOGLE_CLIENT_ID`
- **用戶端密鑰**：貼到 `GOOGLE_CLIENT_SECRET`

```env
GOOGLE_CLIENT_ID="1234567890-abcdefghijklmnop.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET="GOCSPX-abcdefghijklmnopqrstuvwxyz"
```

##### 3.5 ADMIN_EMAILS（必須設定）
**設定管理員帳號**：
```env
ADMIN_EMAILS="你的email@gmail.com"
```
⚠️ **重要**：這必須是你剛才用來建立 Google Cloud 專案的同一個 email

#### 🟡 選用的變數

##### 3.6 BLOB_READ_WRITE_TOKEN（圖片上傳功能）

如果你想要圖片上傳功能，需要設定 Vercel Blob：

**步驟A：建立 Vercel 帳號**
1. 前往 [Vercel](https://vercel.com/)
2. 用 GitHub 帳號註冊/登入

**步驟B：建立專案**
1. 點擊「Add New...」→「Project」
2. 選擇「Browse All Templates」
3. 選擇任意範本建立一個測試專案（之後可以刪除）

**步驟C：建立 Blob Storage**
1. 在專案頁面點擊「Storage」
2. 點擊「Create Database」
3. 選擇「Blob」
4. 名稱：`yyselection-images`
5. 點擊「Create」

**步驟D：取得 Token**
1. 建立完成後，點擊 Blob store 名稱
2. 點擊「Settings」頁籤
3. 複製「BLOB_READ_WRITE_TOKEN」的值

```env
BLOB_READ_WRITE_TOKEN="vercel_blob_rw_xxxxxxxxxx"
```

**如果不想設定圖片上傳**：
暫時註解掉或留空即可，其他功能照常運作：
```env
# BLOB_READ_WRITE_TOKEN=""
```

### 步驟 4：檢查 .env 檔案

最終你的 `.env` 檔案應該像這樣：
```env
# 資料庫連線（Docker 環境自動設定，無需修改）
DATABASE_URL="postgresql://postgres:devpassword@db:5432/yyselection"

# NextAuth 設定
NEXTAUTH_URL="http://localhost:3002"
NEXTAUTH_SECRET="你生成的32字符密鑰"

# Google OAuth 設定（必須設定）
GOOGLE_CLIENT_ID="你的-google-client-id"
GOOGLE_CLIENT_SECRET="你的-google-client-secret"

# 管理員帳號（必須設定）
ADMIN_EMAILS="你的email@gmail.com"

# Vercel Blob（選用，用於圖片上傳）
BLOB_READ_WRITE_TOKEN="vercel_blob_rw_xxxxxxxxxx"
```

### 步驟 5：啟動專案
```bash
docker-compose up
```

⏰ **首次啟動需要 2-3 分鐘**，因為需要：
- 下載 Docker 映像檔
- 建立 PostgreSQL 資料庫
- 安裝 npm 依賴
- 執行資料庫遷移
- 產生測試資料

### 步驟 6：訪問應用程式

當你看到類似這樣的訊息表示啟動成功：
```
app-1  | ▲ Next.js 15.0.3
app-1  | - Local:        http://localhost:3002
app-1  | - Ready in 2.1s
```

**同時你還會看到資料庫初始化訊息：**
```
app-1  | Prisma schema loaded from prisma/schema.prisma
app-1  | Running seed command: tsx prisma/seed.ts
app-1  | 🌱 Database seeded successfully!
```

**訪問**：http://localhost:3002

### 步驟 7：測試登入

1. 點擊「登入」按鈕
2. 選擇「使用 Google 登入」
3. 使用你在 `ADMIN_EMAILS` 中設定的 email 登入
4. 成功登入後，你應該可以看到管理員功能

## ❓ 常見問題

### Q1：Google 登入失敗 "redirect_uri_mismatch"
檢查 Google Cloud Console 中的「已授權的重新導向 URI」是否為：
```
http://localhost:3002/api/auth/callback/google
```

### Q2：登入成功但看不到管理員功能
檢查 `ADMIN_EMAILS` 是否包含你登入的 email

### Q3：容器啟動失敗
```bash
# 查看詳細錯誤
docker-compose logs

# 重新建構
docker-compose up --build

# 完全重置（會刪除資料庫資料）
docker-compose down -v
docker-compose up
```

### Q4：修改 .env 後沒有生效
```bash
# 重啟容器
docker-compose down
docker-compose up
```

### Q5：圖片上傳失敗
如果沒有設定 `BLOB_READ_WRITE_TOKEN`，圖片上傳功能會失效，但其他功能正常。

## 🎉 完成！

恭喜！現在你可以開始開發了：
- **前台**：http://localhost:3002
- **管理後台**：登入後點擊「管理中心」
- **資料庫**：PostgreSQL 運行在 localhost:5432

## 🔧 開發提示

### 熱重載支援
修改程式碼會自動重新載入，無需重啟容器！

### 查看資料庫
```bash
# 進入資料庫容器
docker-compose exec db psql -U postgres -d yyselection

# 查看所有表格
\dt

# 退出
\q
```

### 重新產生測試資料
```bash
# 進入 app 容器
docker-compose exec app sh

# 重新執行 seed
npx prisma db seed

# 退出容器
exit
```

### 重置資料庫
```bash
# 完全重置（會刪除所有資料）
docker-compose down -v
docker-compose up
```

### 停止專案
```bash
# 停止但保留資料
docker-compose down

# 停止並刪除所有資料
docker-compose down -v
```